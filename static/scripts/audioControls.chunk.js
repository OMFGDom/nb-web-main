import{c as e}from"./main.js";import{c as t}from"./audioTimestamps.chunk.js";function a(e){(!isFinite(e)||e<0)&&(e=0);const t=Math.floor(e/60),a=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`}const r={.25:"0.25x",.5:"0.5x",.75:"0.75x",1:"Обычная",1.25:"1.25x",1.5:"1.5x",2:"2x"};function n(n=document){const i=n instanceof Document?n:n.ownerDocument||document,o=i.querySelector(".podcast-hero__player");if(!o)return;const s=o.querySelector("audio.podcast-hero__audio"),c=o.querySelector(".podcast-hero__ctrl--play"),d=o.querySelector("#audio-10sec-prev"),u=o.querySelector("#audio-10sec-next"),l=o.querySelector(".podcast-hero__bar"),h=o.querySelector(".podcast-hero__bar-bg"),p=o.querySelector(".podcast-hero__thumb"),m=o.querySelectorAll(".podcast-hero__time"),v=o.querySelector("#audio-settings"),g=o.querySelector(".audio-settings-panel"),b=o.querySelector('[data-setting="speed"]'),y=o.querySelector(".audio-settings-panel__value"),f=o.querySelector('[data-submenu="speed"]'),L=o.querySelectorAll(".audio-settings-panel__option[data-speed]"),S=o.querySelector(".audio-settings-panel__back-btn"),E=o.querySelector('[data-setting="autoplay"]'),_=o.querySelector("#change-audio-level"),A=o.querySelector(".podcast-hero__volume-btn"),w=o.querySelector(".podcast-hero__volume-panel"),k=o.querySelector(".podcast-hero__volume-track"),q=o.querySelector(".podcast-hero__volume-fill"),x=o.querySelector(".podcast-hero__volume-thumb"),M=o.querySelector(".podcast-hero__volume-level");if(!(s&&c&&l&&h&&p))return;const T=s.getAttribute("data-src");T&&!s.src&&(s.src=T);const X=s.src||T;X&&t(s,X);const C=e=>{c.setAttribute("aria-label",e?"Пауза":"Воспроизвести"),c.setAttribute("title",e?"Пауза":"Воспроизвести");const t=c.querySelector("i");var a;t&&(t.className="",t.classList.add(e?"audio-pause":"audio-play"),a=c,document.dispatchEvent(new CustomEvent("nb:icons:refresh",{detail:{context:a}})))},D=()=>{const e=s.duration||0,t=s.currentTime||0,r=e?Math.min(100,Math.max(0,t/e*100)):0;if(p.style.left=r+"%",m.length>=1&&(m[0].textContent=a(t)),m.length>=2&&(m[m.length-1].textContent=e?a(e):"00:00"),d){const e=t<=.01;d.toggleAttribute("disabled",e),d.setAttribute("aria-disabled",String(e))}if(u){const a=e>0&&t>=e-.01;u.toggleAttribute("disabled",a),u.setAttribute("aria-disabled",String(a))}};function $(e){if(!h||!s)return 0;const t=h.getBoundingClientRect(),a=Math.min(Math.max(e-t.left,0),t.width),r=t.width?a/t.width:0;return(s.duration||0)*r}let F=!1;const P=e=>{F=!0,e instanceof MouseEvent?s.currentTime=$(e.clientX):e.touches&&e.touches[0]&&(s.currentTime=$(e.touches[0].clientX))},R=e=>{F&&(e instanceof MouseEvent?s.currentTime=$(e.clientX):e.touches&&e.touches[0]&&(s.currentTime=$(e.touches[0].clientX)))},j=()=>{F=!1};l.addEventListener("click",e=>{isFinite(s.duration)&&(s.currentTime=$(e.clientX))}),p.addEventListener("mousedown",P),i.addEventListener("mousemove",R),i.addEventListener("mouseup",j),p.addEventListener("touchstart",P,{passive:!0}),i.addEventListener("touchmove",R,{passive:!0}),i.addEventListener("touchend",j),c.addEventListener("click",()=>{s.paused?s.play().catch(t=>e("Audio play failed",t)):s.pause()}),d?.addEventListener("click",()=>{d.hasAttribute("disabled")||(s.currentTime=Math.max(0,s.currentTime-10))}),u?.addEventListener("click",()=>{u.hasAttribute("disabled")||(s.currentTime=Math.min(s.duration||0,s.currentTime+10))}),s.addEventListener("play",()=>C(!0)),s.addEventListener("pause",()=>C(!1)),s.addEventListener("timeupdate",D),s.addEventListener("durationchange",D),s.addEventListener("loadedmetadata",D);let B=1,I=!0;I=(()=>{const e=localStorage.getItem("podcast-autoplay");return null===e||"true"===e})();let z=.7,H=!1,N=z;const U=()=>window.innerWidth<768,W=e=>{if(!q||!x||!M)return;const t=100*e,a=119*e-6;q.style.width=`${t}%`,x.style.left=`${Math.max(0,Math.min(107,a))}px`,M.textContent=Math.round(10*e).toString(),x&&x.setAttribute("aria-valuenow",Math.round(10*e).toString())},G=(t,a=!0)=>{z=Math.max(0,Math.min(1,t)),a&&(s.volume=z),W(z);const r=0===z;r!==H&&J(r,!1),e()},J=(t,a=!0)=>{if(H=t,_){if(t)_.classList.add("muted"),A?.setAttribute("aria-label","Включить звук"),A?.setAttribute("title","Включить звук"),a&&(N=z>0?z:.7,s.volume=0,W(0));else if(_.classList.remove("muted"),A?.setAttribute("aria-label","Регулировка громкости"),A?.setAttribute("title","Регулировка громкости"),a){z=N>0?N:.7,s.volume=z,W(z)}e()}},K=e=>{if(!k)return z;const t=k.getBoundingClientRect();return Math.max(0,Math.min(e-t.left,t.width))/t.width};let O=!1;A?.addEventListener("click",()=>{if(U())J(!H);else if(w){const e=w.classList.contains("show");w.classList.toggle("show",!e)}}),k?.addEventListener("click",e=>{if(U())return;const t=K(e.clientX);G(t),J(!1,!1)}),x?.addEventListener("mousedown",e=>{U()||(O=!0,x?.classList.add("grabbing"),e instanceof MouseEvent?G(K(e.clientX)):e.touches&&e.touches[0]&&G(K(e.touches[0].clientX)),J(!1,!1))}),i.addEventListener("mousemove",e=>{O&&!U()&&(e instanceof MouseEvent?G(K(e.clientX)):e.touches&&e.touches[0]&&G(K(e.touches[0].clientX)))}),i.addEventListener("mouseup",()=>{O=!1,x?.classList.remove("grabbing")}),i.addEventListener("click",e=>{U()||_?.contains(e.target)||!w||w.classList.remove("show")}),x?.addEventListener("keydown",e=>{let t=z;switch(e.key){case"ArrowLeft":case"ArrowDown":t=Math.max(0,z-.1),e.preventDefault();break;case"ArrowRight":case"ArrowUp":t=Math.min(1,z+.1),e.preventDefault();break;case"Home":t=0,e.preventDefault();break;case"End":t=1,e.preventDefault()}t!==z&&(G(t),J(!1,!1))}),window.addEventListener("resize",()=>{w&&w.classList.remove("show")}),G(z),s.volume=z;const Q=()=>{if(!g)return;const e="false"===g.getAttribute("aria-hidden");g.setAttribute("aria-hidden",String(e)),v?.classList.toggle("open",!e),e&&f&&f.setAttribute("aria-hidden","true")},V=()=>{f&&f.setAttribute("aria-hidden","true")},Y=t=>{B=t,s.playbackRate=t,(e=>{y&&(y.textContent=r[String(e)]||`${e}x`)})(t),L.forEach(e=>{const a=parseFloat(e.getAttribute("data-speed")||"1");e.classList.toggle("audio-settings-panel__option--active",a===t)}),e()},Z=()=>{var t;I=!I,t=I,localStorage.setItem("podcast-autoplay",String(t)),e(),E&&E.setAttribute("aria-checked",String(I)),e()};v?.addEventListener("click",Q),i.addEventListener("click",e=>{if(!g||!v)return;g.contains(e.target)||v.contains(e.target)||"false"!==g.getAttribute("aria-hidden")||Q()}),b?.addEventListener("click",e=>{e.stopPropagation(),f&&f.setAttribute("aria-hidden","false")}),S?.addEventListener("click",e=>{e.stopPropagation(),V()}),L.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const a=parseFloat(e.getAttribute("data-speed")||"1");Y(a),V(),Q()})}),E?.addEventListener("click",e=>{e.stopPropagation(),Z()}),Y(B),E&&E.setAttribute("aria-checked",String(I));const ee=()=>{I&&s.readyState>=2&&s.play().catch(t=>{e("Autoplay failed (likely due to browser policy)",t)})};s.readyState>=2?ee():s.addEventListener("loadeddata",ee,{once:!0}),D(),e()}export{n as initAudioControls};
