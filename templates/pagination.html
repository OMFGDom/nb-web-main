{# базовый URL с сохранением q/s #}
{% set base_url = '?' %}
{% if q is defined and q %}{% set base_url = base_url + 'q=' + (q|urlencode if q is string else q)|string + '&' %}{% endif %}
{% if s is defined and s %}{% set base_url = base_url + 's=' + (s|urlencode if s is string else s)|string + '&' %}{% endif %}

{# служебные переменные #}
{% set total = (page.pages or 0)|int %}
{% set current = (page.page or 1)|int %}
{% if total > 1 %}
  {% set window = 2 %}
  {% set start = current - window %}
  {% if start < 1 %}{% set start = 1 %}{% endif %}
  {% set end = current + window %}
  {% if end > total %}{% set end = total %}{% endif %}

  <ul class="global-pagination" role="navigation" aria-label="Пагинация">

    {# PREV #}
    {% if current > 1 %}
      <li class="button-navigation">
        <a href="{{ base_url }}page={{ current - 1 }}" aria-label="Предыдущая страница">
          <i class="pagination-arrow-prev"></i>
        </a>
      </li>
    {% else %}
      <li class="button-navigation disabled">
        <a href="#" aria-label="Предыдущая страница">
          <i class="pagination-arrow-prev"></i>
        </a>
      </li>
    {% endif %}

    {# первая страница и ведущие многоточия #}
    {% if start > 1 %}
      <li>
        <a href="{{ base_url }}page=1" aria-label="Страница 1">1</a>
      </li>
      {% if start > 2 %}
        <li aria-hidden="true">…</li>
      {% endif %}
    {% endif %}

    {# центральное окно страниц #}
    {% for i in range(start, end + 1) %}
      {% if i == current %}
        <li class="is-current">
          <a href="#" aria-current="page" aria-label="Страница {{ i }}">{{ i }}</a>
        </li>
      {% else %}
        <li>
          <a href="{{ base_url }}page={{ i }}" aria-label="Страница {{ i }}">{{ i }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {# завершающие многоточия и последняя страница #}
    {% if end < total %}
      {% if end < total - 1 %}
        <li aria-hidden="true">…</li>
      {% endif %}
      <li>
        <a href="{{ base_url }}page={{ total }}" aria-label="Страница {{ total }}">{{ total }}</a>
      </li>
    {% endif %}

    {# NEXT #}
    {% if current < total %}
      <li class="button-navigation">
        <a href="{{ base_url }}page={{ current + 1 }}" aria-label="Следующая страница">
          <i class="pagination-arrow-next"></i>
        </a>
      </li>
    {% else %}
      <li class="button-navigation disabled">
        <a href="#" aria-label="Следующая страница">
          <i class="pagination-arrow-next"></i>
        </a>
      </li>
    {% endif %}

  </ul>
{% endif %}
