{% extends "base.html" %}
{% block meta_data %}
{% set base_url = SITE_URL or 'https://nationalbusiness.kz' %}

<title>Автор {{ author.firstName }} {{ author.lastName }} | nationalbusiness.kz</title>
<link rel="canonical" href="{{ base_url }}/authors/{{ author.id }}/"/>
<meta name="description"
  content="{{ author.description or ('Автор ' ~ author.firstName ~ ' ' ~ author.lastName ~ ' на nationalbusiness.kz') }}" />
<meta name="keywords" content="Автор {{ author.firstName }} {{ author.lastName }}"/>
<meta name="author" content="Редакция nationalbusiness.kz" />

<meta property="og:type"        content="profile" />
<meta property="og:title"       content="{{ author.firstName }} {{ author.lastName }} | nationalbusiness.kz" />
<meta property="og:description"
  content="{{ author.description or ('Читайте материалы автора ' ~ author.firstName ~ ' ' ~ author.lastName ~ ' на nationalbusiness.kz') }}" />
<meta property="og:url"         content="{{ base_url }}/authors/{{ author.id }}/" />
<meta property="og:image"
      content="{{ author.image.image_jpeg_800|default('/static/img/plug.jpg') }}" />

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ProfilePage",
  {% set has_image = author.image.image_jpeg_800 or author.image.Image_800_jpeg %}
  {% set has_sameAs = author.socialNetworks %}
  "mainEntity": {
      "@type": "Person",
      "name": "{{ author.firstName }} {{ author.lastName }}",
      "identifier": "{{ author.id }}",
      {% if author.description %}
      "description": "{{ author.description }}",
      {% endif %}
      "url": "{{ base_url }}/authors/{{ author.id }}/"
      {% if has_image %},
          "image": "{% if author.image.image_jpeg_800 %}{{ author.image.image_jpeg_800 }}{% else %}{{ author.image.Image_800_jpeg }}{% endif %}"
      {% endif %}
      {% if has_sameAs %},
          "sameAs": [
              {%- for name, url in author.socialNetworks.items() if url -%}
                  "{{ url }}"{% if not loop.last %},{% endif %}
              {%- endfor -%}
          ]
      {% endif %}
  }
}
</script>
{% endblock meta_data %}

{% block content %}
    {% include 'header_small.html' %}
{# templates/author.html #}
{# templates/author.html - полная версия под новую вёрстку #}
<main class="author-page-layout" id="main" tabindex="-1" aria-labelledby="author-page-title">
  <h1 id="author-page-title" class="visually-hidden">Страница автора</h1>

  {# ======================= HERO ======================= #}
  <section class="author-hero" aria-labelledby="author-name">
    <div class="author-hero__container">
      <div class="author-information">
        {# Аватар #}
        {% set image_webp_800 = author.image.image_webp_800
            | default(author.image.image_800_webp, true)
            | default('/static/img/plug.jpg', true) %}
        {% set image_jpeg_800 = author.image.image_jpeg_800
            | default(author.image.image_800_jpeg, true)
            | default('/static/img/plug.jpg', true) %}
        {% set author_alt = author.image.alt
            | default((author.firstName ~ ' ' ~ author.lastName) if (author.firstName or author.lastName) else 'Автор', true) %}

        <div class="author-hero__avatar" role="img" aria-label="Фото автора: {{ author.firstName }} {{ author.lastName }}">
          <picture>
            <source media="(max-width: 699px)" type="image/webp" srcset="{{ image_webp_800 }}">
            <source media="(min-width: 700px)" type="image/webp" srcset="{{ image_webp_800 }}">
            <img src="{{ image_jpeg_800 }}"
                 alt="{{ author_alt }}"
                 title="{{ author_alt }}"
                 loading="lazy"
                 class="lazy">
          </picture>
        </div>

        <div class="author-information-text">
          <h2 id="author-name" class="author-hero__name">
            {{ author.firstName }} {{ author.lastName }}
          </h2>

          {# В bio — только position, если нет — "редакция National Business" #}
          <p class="author-hero__bio">
            {{ author.position if author.position else 'редакция National Business' }}
          </p>
        </div>
      </div>

      {# ======================= TABS ======================= #}
      <nav class="author-tabs" aria-label="Навигация по странице автора">
        <ul class="author-tabs__list" role="tablist">
          <li role="presentation">
                <a href="#author-about" class="author-tabs__item author-tabs__item--active" role="tab" aria-selected="true">
                Об авторе
              </a>
          </li>
          <li role="presentation">
              <a href="#author-works" class="author-tabs__item" role="tab" aria-selected="false">
                Работы
              </a>
          </li>
        </ul>
      </nav>
    </div>
  </section>

  {# ======================= ABOUT (описание) ======================= #}
  <section id="author-about" class="author-about" aria-labelledby="author-about-title">
    <div class="author-about__container">
      <h2 id="author-about-title" class="visually-hidden">Об авторе</h2>

      {% if author.description %}
        <p class="author-about__text">{{ author.description | safe }}</p>
      {% else %}
        <p class="author-about__text">Нет дополнительной информации.</p>
      {% endif %}
    </div>
  </section>

  {# ======================= WORKS ======================= #}
  <section id="author-works" class="author-works" aria-labelledby="author-works-title">
    <div class="author-works__header">
      <hr class="author-works__divider" aria-hidden="true" />
      <h2 id="author-works-title" class="author-works__title">работы</h2>
    </div>

    <ul class="author-works__list">
      {% for article in page.items %}
        {% set a_webp_800 = article.image.image_webp_800
            | default(article.image.image_800_webp, true)
            | default('/static/img/plug.jpg', true) %}
        {% set a_jpeg_800 = article.image.image_jpeg_800
            | default(article.image.image_800_jpeg, true)
            | default('/static/img/plug.jpg', true) %}
        <li>
          <article class="author-work" aria-labelledby="work-{{ loop.index }}-title">
            <div class="author-work__content">
              {% if article.published_date %}
                <time class="author-work__date"
                      datetime="{{ article.published_date.strftime('%Y-%m-%d') }}">
                  {{ article.published_date.strftime('%d.%m.%Y, %H:%M') }}
                </time>
              {% endif %}

              <h3 id="work-{{ loop.index }}-title" class="author-work__title">
                <a href="{{ SITE_URL }}/news/{{ article.alias }}/">
                  {{ article.title }}
                </a>
              </h3>

              {% if article.excerpt %}
                <p class="author-work__excerpt">{{ article.excerpt }}</p>
              {% elif article.lead %}
                <p class="author-work__excerpt">{{ article.lead }}</p>
              {% endif %}

              <a class="author-work__read"
                 href="{{ SITE_URL }}/news/{{ article.alias }}/"
                 aria-label="Читать статью: {{ article.title }}">
                Читать статью
              </a>
            </div>

            <div class="author-work__thumb"
                 aria-label="Обложка статьи: {{ article.title }}">
              <picture>
                <source media="(max-width: 699px)" type="image/webp" srcset="{{ a_webp_800 }}">
                <source media="(min-width: 700px)" type="image/webp" srcset="{{ a_webp_800 }}">
                <img src="{{ a_jpeg_800 }}"
                     alt="Обложка: {{ article.title }}"
                     title="{{ article.title }}"
                     loading="lazy">
              </picture>
            </div>
          </article>
        </li>
      {% endfor %}
    </ul>

  {% if page.pages > 1 %}
    {% include 'pagination.html' %}
  {% endif %}
  </section>
</main>


    {% include 'footer.html' %}
{% endblock content %}
{% block scripts %}
<script type="module" crossorigin src="/static/scripts/main.js"></script>
{% endblock scripts %}