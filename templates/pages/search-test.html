{% extends "base-noindex.html" %}
{% block meta_data %}
{% endblock meta_data %}
{% block content %}
    {% include 'header.html' %}
    <main>
      <section class="adSection adDesctop">
        <div class="ad-container">
          <div class="ad-wrapper-desctop">
            <div id="ad-placeholder" class="ad-placeholder">BES.media</div>
            <div id="adfox_170955537553561307" class="ad-block"></div>
            <script>
              window.yaContextCb.push(() => {
                Ya.adfoxCode.createAdaptive(
                  {
                    ownerId: 264109,
                    containerId: "adfox_170955537553561307",
                    params: {
                      p1: "dbhtm",
                      p2: "iwpg",
                    },
                  },
                  ["desktop", "tablet"],
                  {
                    tabletWidth: 830,
                    phoneWidth: 480,
                    isAutoReloads: false,
                  }
                );

                const placeholder = document.getElementById("ad-placeholder");
                const adBlock = document.getElementById(
                  "adfox_170955537553561307"
                );

                const observer = new MutationObserver(() => {
                  if (adBlock.children.length > 0) {
                    placeholder?.remove();
                    observer.disconnect();
                  }
                });

                observer.observe(adBlock, { childList: true });
              });
            </script>
          </div>
        </div>
        </section>
      <section class="categoryPage sectionDesctopMargin">
          <div class="container">
            <div class="categoryPage__wrapper">
              <div class="categoryPage__body">
                <h1 class="page__title">Поиск</h1>
                <form action="/search" class="page__search mb">
                    <input type="text" name="q" placeholder="Поиск" value="{{ q | default('') }}">
                    <button class="page__search-icon" type="submit">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 0 20 21" fill="none">
                        <path d="M9.16699 2.16666C13.307 2.16666 16.667 5.52666 16.667 9.66666C16.667 13.8067 13.307 17.1667 9.16699 17.1667C5.02699 17.1667 1.66699 13.8067 1.66699 9.66666C1.66699 5.52666 5.02699 2.16666 9.16699 2.16666ZM9.16699 15.5C12.3899 15.5 15.0003 12.8896 15.0003 9.66666C15.0003 6.44374 12.3899 3.83332 9.16699 3.83332C5.94408 3.83332 3.33366 6.44374 3.33366 9.66666C3.33366 12.8896 5.94408 15.5 9.16699 15.5ZM16.2381 15.5592L18.5951 17.9162L17.4166 19.0947L15.0596 16.7377L16.2381 15.5592Z" fill="#2D2D2D"></path>
                      </svg>
                    </button>
                </form>
                {% if not page.items %}
                  <div class="page__placeholder">По вашему запросу нет записей.</div>
                {% endif %}
                <div class="categoryPage__list">
                  {% for article in page.items %}
                    {% with
                      image_webp_800 = article.image.image_webp_800 | default(article.image.image_800_webp, true) | default('/static/img/plug.jpg', true),
                      image_jpeg_800 = article.image.image_jpeg_800 | default(article.image.image_800_jpeg, true) | default('/static/img/plug.jpg', true)
                    %}
                    <div class="card page">
                      <a href="https://bes.media/news/{{ article.alias }}/">
                        <picture>
                          <source media="(max-width: 699px)" type="image/webp" srcset="{{ image_webp_800 }}" />
                          <source media="(min-width: 700px)" type="image/webp" srcset="{{ image_webp_800 }}" />
                          <img src="{{ image_jpeg_800 }}" alt="{{ article.title }}" />
                        </picture>
                        <div class="card__content">
                          <div class="card__title">
                            {{ article.title }}
                          </div>
                          <div class="card__info">
                            <div class="card__category">
                              {{ article.categories[0].title if article.categories }}
                            </div>
                            <div class="card__time" data-published="{{ article.published_date }}">
                              {{ article.published_date.strftime('%d.%m.%Y, %H:%M') }}
                            </div>
                          </div>
                        </div>
                      </a>
                    </div>
                    {% endwith %}
                  {% endfor %}
                </div>

                {% if page.pages > 1 %}
                  {% include 'pagination.html' %}
                {% endif %}
              </div>

              <div class="categoryPage__aside">
                 <div class="ad-wrapper-desctop-aside">
                  <div id="ad-placeholder" class="ad-placeholder">
                    BES.media
                  </div>
                  <div id="adfox_170955552941919482"></div>
                  <script>
                    window.yaContextCb.push(() => {
                      Ya.adfoxCode.createAdaptive(
                        {
                          ownerId: 264109,
                          containerId: "adfox_170955552941919482",
                          params: {
                            p1: "dbhto",
                            p2: "iwpl",
                          },
                        },
                        ["desktop", "tablet"],
                        {
                          tabletWidth: 830,
                          phoneWidth: 480,
                          isAutoReloads: false,
                        }
                      );
                    });
                  </script>
                </div>
                 <div class="ad-wrapper-mobile-big adMobile">
                  <div id="ad-placeholder" class="ad-placeholder">
                    BES.media
                  </div>
                  <div id="adfox_17095555565288808"></div>
                  <script>
                    window.yaContextCb.push(() => {
                      Ya.adfoxCode.createAdaptive(
                        {
                          ownerId: 264109,
                          containerId: "adfox_17095555565288808",
                          params: {
                            p1: "dbhtj",
                            p2: "iwpn",
                          },
                        },
                        ["phone"],
                        {
                          tabletWidth: 830,
                          phoneWidth: 480,
                          isAutoReloads: false,
                        }
                      );
                    });
                  </script>
                </div>
              </div>
            </div>
          </div>
        </section>
    </main>
    {% include 'footer.html' %}
    {% include 'drawer.html' %}
{% endblock content %}
{% block scripts %}
    <script src="/static/js/index.bundle.js?v=1.7"></script>
{% endblock scripts %}
